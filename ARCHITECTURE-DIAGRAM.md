# Dynamic Endpoint Architecture

## System Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────┐
│                         DYNAMIC ENDPOINT SYSTEM                      │
└─────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────┐
│                          1. CONFIGURATION LAYER                      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌──────────────┐                                                   │
│  │   .env File  │                                                   │
│  ├──────────────┤                                                   │
│  │ ENDPOINT=    │  ◄─── Single source of truth for base URL        │
│  │ https://...  │                                                   │
│  └──────────────┘                                                   │
│         │                                                            │
│         ▼                                                            │
│  ┌──────────────────────┐                                          │
│  │  config/api-config.js │                                          │
│  ├──────────────────────┤                                          │
│  │ Reads ENDPOINT       │                                          │
│  │ Creates baseURL      │                                          │
│  └──────────────────────┘                                          │
│                                                                       │
└─────────────────────────────────────────────────────────────────────┘

                              │
                              ▼

┌─────────────────────────────────────────────────────────────────────┐
│                          2. SCHEMA LAYER                             │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌────────────────────────────────────────────────────────────┐    │
│  │  test-data/Input/Main-Standarized-Backend-Api-Schema.json  │    │
│  ├────────────────────────────────────────────────────────────┤    │
│  │  {                                                          │    │
│  │    "Post": [                                                │    │
│  │      "/erp-apis/ChartOfAccounts/GetTree",  ◄─── Extension  │    │
│  │      { "payload": "data" }                                  │    │
│  │    ]                                                        │    │
│  │  }                                                          │    │
│  └────────────────────────────────────────────────────────────┘    │
│                                                                       │
│  ┌────────────────────────────────────────────────────────────┐    │
│  │  test-data/Input/Main-Backend-Api-Schema.json              │    │
│  └────────────────────────────────────────────────────────────┘    │
│                                                                       │
│  ┌────────────────────────────────────────────────────────────┐    │
│  │  test-data/Input/JL-Backend-Api-Schema.json                │    │
│  └────────────────────────────────────────────────────────────┘    │
│                                                                       │
└─────────────────────────────────────────────────────────────────────┘

                              │
                              ▼

┌─────────────────────────────────────────────────────────────────────┐
│                          3. API CLIENT LAYER                         │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌──────────────────────────────────────────────────────────┐      │
│  │  utils/api-client.js                                      │      │
│  ├──────────────────────────────────────────────────────────┤      │
│  │                                                            │      │
│  │  constructFullUrl(extension) {                            │      │
│  │    // Combines base URL + extension                       │      │
│  │    return baseURL + extension                             │      │
│  │  }                                                         │      │
│  │                                                            │      │
│  │  ┌─────────────────────────────────────────────────┐     │      │
│  │  │  Input:  "/erp-apis/JournalEntry"               │     │      │
│  │  │  Base:   "https://microtecsaudi.com:2032"       │     │      │
│  │  │  Output: "https://microtecsaudi.com:2032/       │     │      │
│  │  │           erp-apis/JournalEntry"                 │     │      │
│  │  └─────────────────────────────────────────────────┘     │      │
│  │                                                            │      │
│  └──────────────────────────────────────────────────────────┘      │
│                                                                       │
└─────────────────────────────────────────────────────────────────────┘

                              │
                              ▼

┌─────────────────────────────────────────────────────────────────────┐
│                          4. HTTP REQUEST LAYER                       │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌──────────────────────────────────────────────────────────┐      │
│  │  Axios HTTP Client                                        │      │
│  ├──────────────────────────────────────────────────────────┤      │
│  │                                                            │      │
│  │  GET  https://microtecsaudi.com:2032/erp-apis/...        │      │
│  │  POST https://microtecsaudi.com:2032/erp-apis/...        │      │
│  │  PUT  https://microtecsaudi.com:2032/erp-apis/...        │      │
│  │  DELETE https://microtecsaudi.com:2032/erp-apis/...      │      │
│  │                                                            │      │
│  └──────────────────────────────────────────────────────────┘      │
│                                                                       │
└─────────────────────────────────────────────────────────────────────┘

                              │
                              ▼

┌─────────────────────────────────────────────────────────────────────┐
│                          5. BACKEND API                              │
├─────────────────────────────────────────────────────────────────────┤
│                                                                       │
│  ┌──────────────────────────────────────────────────────────┐      │
│  │  Backend Server                                           │      │
│  │  https://microtecsaudi.com:2032                           │      │
│  ├──────────────────────────────────────────────────────────┤      │
│  │                                                            │      │
│  │  /erp-apis/ChartOfAccounts/GetTree                        │      │
│  │  /erp-apis/JournalEntry                                   │      │
│  │  /erp-apis/DiscountPolicy                                 │      │
│  │  ...                                                       │      │
│  │                                                            │      │
│  └──────────────────────────────────────────────────────────┘      │
│                                                                       │
└─────────────────────────────────────────────────────────────────────┘
```

---

## Data Flow Diagram

```
┌──────────────┐
│  Test Suite  │
└──────┬───────┘
       │
       │ 1. Reads schema
       ▼
┌──────────────────────────────────────┐
│  Schema File                         │
│  Extension: "/erp-apis/JournalEntry" │
└──────┬───────────────────────────────┘
       │
       │ 2. Passes extension to API client
       ▼
┌──────────────────────────────────────┐
│  API Client                          │
│  - Reads baseURL from config         │
│  - Constructs full URL               │
└──────┬───────────────────────────────┘
       │
       │ 3. Combines base + extension
       ▼
┌──────────────────────────────────────────────────────┐
│  Full URL                                             │
│  "https://microtecsaudi.com:2032/erp-apis/           │
│   JournalEntry"                                       │
└──────┬───────────────────────────────────────────────┘
       │
       │ 4. Makes HTTP request
       ▼
┌──────────────────────────────────────┐
│  Backend API                         │
│  Processes request                   │
│  Returns response                    │
└──────┬───────────────────────────────┘
       │
       │ 5. Returns response
       ▼
┌──────────────┐
│  Test Suite  │
│  Validates   │
└──────────────┘
```

---

## Environment Switching Flow

```
┌─────────────────────────────────────────────────────────────┐
│                    ENVIRONMENT SWITCHING                     │
└─────────────────────────────────────────────────────────────┘

DEVELOPMENT ENVIRONMENT
┌──────────────────────────────────────────────────────────────┐
│  .env                                                         │
│  ENDPOINT=https://dev.microtecsaudi.com:2032                 │
└──────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────┐
│  All API calls go to:                                         │
│  https://dev.microtecsaudi.com:2032/erp-apis/...             │
└──────────────────────────────────────────────────────────────┘

                              │
                              │ Change .env
                              ▼

STAGING ENVIRONMENT
┌──────────────────────────────────────────────────────────────┐
│  .env                                                         │
│  ENDPOINT=https://staging.microtecsaudi.com:2032             │
└──────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────┐
│  All API calls go to:                                         │
│  https://staging.microtecsaudi.com:2032/erp-apis/...         │
└──────────────────────────────────────────────────────────────┘

                              │
                              │ Change .env
                              ▼

PRODUCTION ENVIRONMENT
┌──────────────────────────────────────────────────────────────┐
│  .env                                                         │
│  ENDPOINT=https://microtecsaudi.com:2032                     │
└──────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌──────────────────────────────────────────────────────────────┐
│  All API calls go to:                                         │
│  https://microtecsaudi.com:2032/erp-apis/...                 │
└──────────────────────────────────────────────────────────────┘
```

---

## URL Construction Process

```
┌─────────────────────────────────────────────────────────────┐
│                    URL CONSTRUCTION                          │
└─────────────────────────────────────────────────────────────┘

Step 1: Read Configuration
┌──────────────────────────────────────┐
│  .env                                 │
│  ENDPOINT=https://example.com:2032   │
└──────────────────────────────────────┘
                │
                ▼
┌──────────────────────────────────────┐
│  config/api-config.js                │
│  baseURL = process.env.ENDPOINT      │
└──────────────────────────────────────┘

Step 2: Read Schema
┌──────────────────────────────────────┐
│  Schema                               │
│  extension = "/erp-apis/JournalEntry"│
└──────────────────────────────────────┘

Step 3: Construct URL
┌──────────────────────────────────────────────────────┐
│  API Client                                           │
│  fullURL = baseURL + extension                       │
│  fullURL = "https://example.com:2032" +              │
│            "/erp-apis/JournalEntry"                  │
│  fullURL = "https://example.com:2032/erp-apis/      │
│            JournalEntry"                             │
└──────────────────────────────────────────────────────┘

Step 4: Make Request
┌──────────────────────────────────────────────────────┐
│  HTTP Request                                         │
│  GET https://example.com:2032/erp-apis/JournalEntry │
└──────────────────────────────────────────────────────┘
```

---

## Schema Management Workflow

```
┌─────────────────────────────────────────────────────────────┐
│                    SCHEMA MANAGEMENT                         │
└─────────────────────────────────────────────────────────────┘

INITIAL STATE (Hardcoded URLs)
┌──────────────────────────────────────────────────────────────┐
│  Schema                                                       │
│  "Post": [                                                    │
│    "https://microtecsaudi.com:2032/erp-apis/JournalEntry",  │
│    { "data": "..." }                                          │
│  ]                                                            │
└──────────────────────────────────────────────────────────────┘
                              │
                              │ Run: npm run schema:convert-urls
                              ▼
INTERMEDIATE STATE (Some non-URLs converted)
┌──────────────────────────────────────────────────────────────┐
│  Schema                                                       │
│  "Post": [                                                    │
│    "/erp-apis/JournalEntry",                                 │
│    { "data": "..." }                                          │
│  ]                                                            │
│  "branches": ["/e15567cc-a567-45ed-b96b-02ad216bd2c4"]      │
└──────────────────────────────────────────────────────────────┘
                              │
                              │ Run: npm run schema:fix-non-urls
                              ▼
FINAL STATE (Clean extensions)
┌──────────────────────────────────────────────────────────────┐
│  Schema                                                       │
│  "Post": [                                                    │
│    "/erp-apis/JournalEntry",                                 │
│    { "data": "..." }                                          │
│  ]                                                            │
│  "branches": ["e15567cc-a567-45ed-b96b-02ad216bd2c4"]       │
└──────────────────────────────────────────────────────────────┘

OR USE MASTER SCRIPT
┌──────────────────────────────────────────────────────────────┐
│  npm run schema:update                                        │
│  (Runs both scripts automatically)                            │
└──────────────────────────────────────────────────────────────┘
```

---

## Component Interaction Diagram

```
┌─────────────────────────────────────────────────────────────┐
│                    COMPONENT INTERACTIONS                    │
└─────────────────────────────────────────────────────────────┘

┌──────────────┐
│  Test File   │
└──────┬───────┘
       │
       │ imports
       ▼
┌──────────────────────┐
│  CRUD Helper         │
└──────┬───────────────┘
       │
       │ uses
       ▼
┌──────────────────────┐
│  Modules Config      │◄──── reads ──── Schema Files
└──────┬───────────────┘
       │
       │ provides extension
       ▼
┌──────────────────────┐
│  API Client          │◄──── reads ──── API Config
└──────┬───────────────┘                      │
       │                                      │
       │ makes request                        │ reads
       ▼                                      ▼
┌──────────────────────┐              ┌──────────────┐
│  Backend API         │              │  .env File   │
└──────────────────────┘              └──────────────┘
```

---

## Key Concepts

### 1. Separation of Concerns
```
┌─────────────────┐
│  Configuration  │ ◄─── .env file
├─────────────────┤
│  Data           │ ◄─── Schema files
├─────────────────┤
│  Logic          │ ◄─── API Client
├─────────────────┤
│  Execution      │ ◄─── Test files
└─────────────────┘
```

### 2. Single Source of Truth
```
         ┌──────────────┐
         │  .env File   │
         │  ENDPOINT=   │
         └──────┬───────┘
                │
    ┌───────────┼───────────┐
    │           │           │
    ▼           ▼           ▼
┌────────┐ ┌────────┐ ┌────────┐
│ Test 1 │ │ Test 2 │ │ Test N │
└────────┘ └────────┘ └────────┘
   All use the same base URL
```

### 3. Dynamic Configuration
```
Change .env → Restart → All tests use new endpoint
     │           │              │
     ▼           ▼              ▼
  1 second   Automatic    Zero code changes
```

---

## Benefits Visualization

```
BEFORE (Hardcoded)
┌─────────────────────────────────────────────────────────┐
│  Schema 1: https://microtecsaudi.com:2032/api/...      │
│  Schema 2: https://microtecsaudi.com:2032/api/...      │
│  Schema 3: https://microtecsaudi.com:2032/api/...      │
│  ...                                                     │
│  Schema 440: https://microtecsaudi.com:2032/api/...    │
└─────────────────────────────────────────────────────────┘
To change endpoint: Update 440 URLs manually ❌

AFTER (Dynamic)
┌─────────────────────────────────────────────────────────┐
│  .env: ENDPOINT=https://microtecsaudi.com:2032         │
│  Schema 1: /api/...                                     │
│  Schema 2: /api/...                                     │
│  Schema 3: /api/...                                     │
│  ...                                                     │
│  Schema 440: /api/...                                   │
└─────────────────────────────────────────────────────────┘
To change endpoint: Update 1 line in .env ✅
```

---

**Last Updated:** November 26, 2025  
**Version:** 1.0.0
